<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>オニヤンマ生地</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }
    th {
      background: #f2f2f2;
    }
    input {
      padding: 5px;
      margin-right: 5px;
    }
    button {
      padding: 6px 10px;
    }
  </style>
</head>
<body>

<h2>オニヤンマ生地（FIFO 管理）</h2>

<!-- INPUT AREA -->
<input id="sana" placeholder="sana（例: 2026-01-18）">
<input id="mixing" type="number" placeholder="ミキシング">
<input id="delivery" type="number" placeholder="搬入">
<button onclick="addEntry()">追加</button>

<!-- TABLE -->
<table>
  <thead>
    <tr>
      <th>sana</th>
      <th>ミキシング</th>
      <th>生地（×4）</th>
      <th>搬入</th>
      <th>のこり</th>
    </tr>
  </thead>
  <tbody id="tableBody"></tbody>
</table>

<button onclick="clearAll()">全データ削除</button>

<script>
let data = JSON.parse(localStorage.getItem("oniyanmaKijiData")) || [];

function addEntry() {
  const sana = document.getElementById("sana").value;
  const mixing = Number(document.getElementById("mixing").value);
  const delivery = Number(document.getElementById("delivery").value || 0);

  if (!sana || mixing <= 0) {
    alert("sana と ミキシング を入力してください");
    return;
  }

  let kiji = mixing * 4;
  let remainingDelivery = delivery;

  // FIFO: subtract 搬入 from oldest 生地 first
  for (let row of data) {
    if (remainingDelivery <= 0) break;
    let used = Math.min(row.remaining, remainingDelivery);
    row.remaining -= used;
    remainingDelivery -= used;
  }

  let remainingToday = kiji - remainingDelivery;
  if (remainingToday < 0) remainingToday = 0;

  data.push({
    sana: sana,
    mixing: mixing,
    kiji: kiji,
    delivery: delivery,
    remaining: remainingToday
  });

  saveAndRender();
  clearInputs();
}

function saveAndRender() {
  localStorage.setItem("oniyanmaKijiData", JSON.stringify(data));
  render();
}

function render() {
  const body = document.getElementById("tableBody");
  body.innerHTML = "";

  data.forEach(row => {
    body.innerHTML += `
      <tr>
        <td>${row.sana}</td>
        <td>${row.mixing}</td>
        <td>${row.kiji}</td>
        <td>${row.delivery}</td>
        <td>${row.remaining}</td>
      </tr>
    `;
  });
}

function clearInputs() {
  document.getElementById("mixing").value = "";
  document.getElementById("delivery").value = "";
}

function clearAll() {
  if (confirm("すべてのデータを削除しますか？")) {
    data = [];
    localStorage.removeItem("oniyanmaKijiData");
    render();
  }
}

render();
</script>

</body>
</html>
